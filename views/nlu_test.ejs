<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>NLU Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#fafafa; }
    .wrap { max-width: 760px; margin: 40px auto; background:#fff; padding:24px; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    input, button { font-size: 16px; padding: 12px; }
    input { width:70%; border:1px solid #e5e7eb; border-radius:12px; }
    button { border:0; border-radius:12px; padding:12px 18px; cursor:pointer; }
    pre { background:#0f172a; color:#e2e8f0; padding:16px; border-radius:12px; overflow:auto; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Doğal Dille Sorgu</h1>
    <form id="f">
      <input id="q" type="text" placeholder="Örn: 2024 yılında markette kaç litre rakı satıldı" />
      <button>Gönder</button>
    </form>

    <h3>1) NLU Çıktısı</h3>
    <pre id="out">⏳ Bekleniyor...</pre>

    <h3>2) Aksiyon Sonucu</h3>
    <pre id="out2">⏳ Bekleniyor...</pre>
  </div>

  <script>
    const f = document.getElementById('f');
    const q = document.getElementById('q');
    const out = document.getElementById('out');
    const out2 = document.getElementById('out2');

    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      out.textContent = 'İşleniyor...';
      out2.textContent = 'Bekleniyor...';

      const nlu = await fetch('/nlu/parse', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text: q.value })
      }).then(r => r.json());

      out.textContent = JSON.stringify(nlu, null, 2);

      if (nlu.intent && nlu.intent !== 'fallback') {
        const act = await fetch('/action', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ intent: nlu.intent, slots: nlu.slots })
        }).then(r => r.json());
        out2.textContent = JSON.stringify(act, null, 2);
      } else {
        out2.textContent = 'Niyet düşük güvenle tespit edildi (fallback).';
      }
    });
  </script>
</body>
</html>
