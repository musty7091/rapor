<%- include('partials/header') %>
<%- include('partials/sidebar') %>

<main class="main-content">
    <h1><%= sayfaBasligi %></h1>
    
    <form action="/temsilci-performans" method="GET" class="filter-form">
        <div class="form-group">
            <label for="yil">Yıl</label>
            <select name="yil" id="yil">
                <option value="">Tümü</option>
                <option value="2024" <%= (filtreler.yil == '2024') ? 'selected' : '' %>>2024</option>
                <option value="2025" <%= (filtreler.yil == '2025') ? 'selected' : '' %>>2025</option>
            </select>
        </div>
        <div class="form-group">
            <label for="ay">Ay</label>
            <select name="ay" id="ay">
                <option value="">Tümü</option>
                <% for(let i=1; i<=12; i++) { %>
                    <option value="<%= i %>" <%= (filtreler.ay == i) ? 'selected' : '' %>><%= i %>. Ay</option>
                <% } %>
            </select>
        </div>
        <div class="form-group">
            <label for="temsilci">Satış Temsilcisi</label>
            <select name="temsilci" id="temsilci">
                <option value="">Tümü</option>
                <% if (temsilciler) { %>
                    <% temsilciler.forEach(t => { %>
                        <option value="<%= t.SATISTEMSILCI %>" <%= (filtreler.temsilci === t.SATISTEMSILCI) ? 'selected' : '' %>>
                            <%= t.SATISTEMSILCI %>
                        </option>
                    <% }) %>
                <% } %>
            </select>
        </div>
        <button type="submit">Filtrele</button>
        <a href="/temsilci-performans" class="reset-button">Sıfırla</a>
    </form>

    <div class="kpi-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
        <div class="kpi-card">
            <div class="icon"><i class="fa-solid fa-coins"></i></div>
            <div class="info">
                <h3>Toplam Ciro</h3>
                <div class="value"><%= sonuc.ToplamCiro.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) %></div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="icon"><i class="fa-solid fa-piggy-bank"></i></div>
            <div class="info">
                <h3>Toplam Brüt Kâr</h3>
                <div class="value"><%= sonuc.ToplamKar.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) %></div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="icon"><i class="fa-solid fa-percent"></i></div>
            <div class="info">
                <h3>Kârlılık Oranı</h3>
                <% const karlilik = sonuc.ToplamCiro > 0 ? (sonuc.ToplamKar / sonuc.ToplamCiro) * 100 : 0; %>
                <div class="value karlilik"><%= karlilik.toFixed(2) %>%</div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="icon"><i class="fa-solid fa-users"></i></div>
            <div class="info">
                <h3>Ulaşılan Müşteri Sayısı</h3>
                <div class="value"><%= sonuc.MusteriSayisi %></div>
            </div>
        </div>
    </div>
</main>

<%- include('partials/footer') %>